{"version":3,"file":"deparam.js","sources":["../../src/deparam.js"],"sourcesContent":["/**\n * Deparam plugin\n * Converts a querystring to a JavaScript object\n * @project      Deparam plugin\n * @date         2018-08-18\n * @author       Sachin Singh <ssingh.300889@gmail.com>\n * @version      1.1.0\n */\n\n// Vars\nconst isBrowser = typeof window !== \"undefined\";\nconst isNode = typeof global !== \"undefined\";\n\n// Shorthand for built-ins\nconst isArr = Array.isArray;\n\n/**\n * Checks if input is a number\n * @param {*} key \n */\nfunction isNumber(key) {\n    key = (key + \"\").trim();\n    if (['null', 'undefined', ''].indexOf(key) > -1) return false;\n    return !isNaN(Number(key));\n}\n\n/**\n * Checks if key is a true object\n * @param {*} key Any type of value\n */\nfunction isObject(key) {\n    return (key != null && !isArr(key) && key.toString() === \"[object Object]\");\n}\n\n/**\n * Checks if query parameter key is a complex notation\n * @param {string} q \n */\nfunction ifComplex(q) {\n    return (/\\[/.test(q));\n}\n\n/**\n * Converts query string to JavaScript object\n * @param {string} qs query string argument (defaults to url query string)\n */\nfunction deparam(qs = (\n    (isBrowser\n        ? window.location.search\n        : \"\")\n)) {\n    qs = decodeURIComponent(qs).replace(\"?\", \"\").trim();\n    const queryParamList = qs.split(\"&\");\n    const queryObject = {};\n    if (qs) {\n        queryParamList.forEach((qq) => {\n            const qArr = qq.split(\"=\");\n            if (ifComplex(...qArr)) {\n                complex(...qArr, queryObject);\n            } else {\n                simple(qArr, queryObject);\n            }\n        });\n    }\n    return queryObject;\n}\n\n/**\n * Converts an array to an object\n * @param {array} arr \n */\nfunction toObject(arr) {\n    var convertedObj = {};\n    if (isArr(arr)) {\n        arr.forEach((value, index) => {\n            convertedObj[index] = value;\n        });\n    }\n    return convertedObj;\n}\n\n/**\n * Resolves an array to object if required\n * @param {array} ob An array object\n * @param {boolean} isNumber flag to test if next key is number\n */\nfunction resolve(ob, isNextNumber) {\n    if (typeof ob === \"undefined\") return isNextNumber ? [] : {};\n    return isNextNumber ? ob : toObject(ob);\n}\n\n/**\n * Resolves the target object for next iteration\n * @param {Object} ob current reference object\n * @param {string} nextProp reference property in current object\n */\nfunction resolveObj(ob, nextProp) {\n    if (isObject(ob)) return { ob };\n    if (isArr(ob) || typeof ob === \"undefined\") return { ob: resolve(ob, isNumber(nextProp)) };\n    return { ob: [ob], push: ob !== null };\n}\n\n/**\n * Handles complex query parameters\n * @param {string} key \n * @param {string} value \n * @param {Object} obj \n */\nfunction complex(key, value, obj) {\n    const match = key.match(/([^\\[]+)\\[([^\\[]*)\\]/) || [];\n    if (match.length === 3) {\n        let [, prop, nextProp] = match;\n        key = key.replace(/\\[([^\\[]*)\\]/, \"\");\n        if (ifComplex(key)) {\n            if (nextProp === \"\") nextProp = \"0\";\n            key = key.replace(/[^\\[]+/, nextProp);\n            complex(key, value, obj[prop] = resolveObj(obj[prop], nextProp).ob);\n        } else if (nextProp) {\n            const { ob, push } = resolveObj(obj[prop], nextProp);\n            obj[prop] = ob;\n            if (push) {\n                obj[prop].push({\n                    [nextProp]: coerce(value)\n                });\n            } else {\n                obj[prop][nextProp] = coerce(value);\n            }\n        } else {\n            simple([match[1], value], obj, true);\n        }\n    }\n}\n\n/**\n * Handles simple query\n * @param {array} qArr \n * @param {Object} queryObject \n * @param {boolean} toArray \n */\nfunction simple(qArr, queryObject, toArray) {\n    let [key, value] = qArr;\n    // Convert to appropriate type\n    value = coerce(value);\n    if (key in queryObject) {\n        queryObject[key] = isArr(queryObject[key]) ? queryObject[key] : [queryObject[key]];\n        queryObject[key].push(value);\n    } else {\n        queryObject[key] = toArray ? [value] : value;\n    }\n}\n\n/**\n * Restores values to their original type\n * @param {string} value undefined or string value\n */\nfunction coerce(value) {\n    if (value == null) return \"\";\n    if (typeof value !== \"string\") return value;\n    value = value.trim();\n    if (isNumber(value)) return +value;\n    switch (value) {\n        case \"null\": return null;\n        case \"undefined\": return undefined;\n        case \"true\": return true;\n        case \"false\": return false;\n        case \"NaN\": return NaN;\n        default: return value;\n    }\n}\n\nfunction lib() {\n    return deparam.apply(this, arguments);\n}\n\n// Check if global jQuery object exists, then plug-in deparam function as a static method\nif (isBrowser && window.jQuery) {\n    window.jQuery.deparam = lib;\n}\nif (isNode && global.jQuery) {\n    global.jQuery.deparam = lib;\n}\nexport default lib;"],"names":["isBrowser","window","isNode","global","isArr","Array","isArray","isNumber","key","trim","indexOf","isNaN","Number","isObject","toString","ifComplex","q","test","deparam","qs","location","search","decodeURIComponent","replace","queryParamList","split","queryObject","forEach","qq","qArr","complex","simple","toObject","arr","convertedObj","value","index","resolve","ob","isNextNumber","resolveObj","nextProp","push","obj","match","length","prop","coerce","toArray","undefined","NaN","lib","apply","arguments","jQuery"],"mappings":"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"}