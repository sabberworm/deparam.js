{"version":3,"file":"deparam.esm.js","sources":["../../src/deparam.js"],"sourcesContent":["// Vars\nconst isBrowser = typeof window !== \"undefined\";\n\n// Shorthand for built-ins\nconst isArr = Array.isArray;\n\n/**\n * Checks if input is a number\n * @param {*} key \n */\nfunction isNumber(key) {\n    key = (key + \"\").trim();\n    if (['null', 'undefined', ''].indexOf(key) > -1) return false;\n    return !isNaN(Number(key));\n}\n\n/**\n * Checks if key is a true object\n * @param {*} key Any type of value\n */\nfunction isObject(key) {\n    return (key != null && !isArr(key) && key.toString() === \"[object Object]\");\n}\n\n/**\n * Checks if query parameter key is a complex notation\n * @param {string} q \n */\nfunction ifComplex(q) {\n    return (/\\[/.test(q));\n}\n\n/**\n * Sets default value\n * @param {*} value Any value\n * @param {*} defaultValue Default value if value is undefined\n */\nfunction setDefault(value, defaultValue) {\n    return typeof value === 'undefined' ? defaultValue : value;\n}\n\n/**\n * Converts query string to JavaScript object\n * @param {string} qs query string argument (defaults to url query string)\n */\nfunction deparam(qs, coerce) {\n    qs = setDefault(qs, (isBrowser ? window.location.search : \"\")).trim();\n    coerce = setDefault(coerce, true);\n    if (qs.charAt(0) === \"?\") {\n        qs = qs.replace(\"?\", \"\");\n    }\n    const queryParamList = qs.split(\"&\");\n    const queryObject = {};\n    if (qs) {\n        queryParamList.forEach((qq) => {\n            const qArr = qq.split(\"=\").map(part => decodeURIComponent(part));\n            if (ifComplex(qArr[0])) {\n                complex.apply(this, [].concat(qArr).concat([queryObject, coerce]));\n            } else {\n                simple.apply(this, [qArr, queryObject, false, coerce]);\n            }\n        });\n    }\n    return queryObject;\n}\n\n/**\n * Converts an array to an object\n * @param {array} arr \n */\nfunction toObject(arr) {\n    var convertedObj = {};\n    if (isArr(arr)) {\n        arr.forEach((value, index) => {\n            convertedObj[index] = value;\n        });\n    }\n    return convertedObj;\n}\n\n/**\n * Resolves an array to object if required\n * @param {array} ob An array object\n * @param {boolean} isNumber flag to test if next key is number\n */\nfunction resolve(ob, isNextNumber) {\n    if (typeof ob === \"undefined\") return isNextNumber ? [] : {};\n    return isNextNumber ? ob : toObject(ob);\n}\n\n/**\n * Resolves the target object for next iteration\n * @param {Object} ob current reference object\n * @param {string} nextProp reference property in current object\n */\nfunction resolveObj(ob, nextProp) {\n    if (isObject(ob)) return { ob };\n    if (isArr(ob) || typeof ob === \"undefined\") return { ob: resolve(ob, isNumber(nextProp)) };\n    return { ob: [ob], push: ob !== null };\n}\n\n/**\n * Handles complex query parameters\n * @param {string} key \n * @param {string} value \n * @param {Object} obj \n */\nfunction complex(key, value, obj, doCoerce) {\n    doCoerce = setDefault(doCoerce, true);\n    const match = key.match(/([^\\[]+)\\[([^\\[]*)\\]/) || [];\n    if (match.length === 3) {\n        let prop = match[1];\n        let nextProp = match[2];\n        key = key.replace(/\\[([^\\[]*)\\]/, \"\");\n        if (ifComplex(key)) {\n            if (nextProp === \"\") nextProp = \"0\";\n            key = key.replace(/[^\\[]+/, nextProp);\n            complex(key, value, (obj[prop] = resolveObj(obj[prop], nextProp).ob), doCoerce);\n        } else if (nextProp) {\n            const { ob, push } = resolveObj(obj[prop], nextProp);\n            obj[prop] = ob;\n            if (push) {\n                obj[prop].push({\n                    [nextProp]: (doCoerce ? coerce(value) : value)\n                });\n            } else {\n                obj[prop][nextProp] = (doCoerce ? coerce(value) : value);\n            }\n        } else {\n            simple([match[1], value], obj, true);\n        }\n    }\n}\n\n/**\n * Handles simple query\n * @param {array} qArr \n * @param {Object} queryObject \n * @param {boolean} toArray \n */\nfunction simple(qArr, queryObject, toArray, doCoerce) {\n    doCoerce = setDefault(doCoerce, true);\n    let key = qArr[0];\n    let value = qArr[1];\n    if (doCoerce) {\n        value = coerce(value);\n    }\n    if (key in queryObject) {\n        queryObject[key] = isArr(queryObject[key]) ? queryObject[key] : [queryObject[key]];\n        queryObject[key].push(value);\n    } else {\n        queryObject[key] = toArray ? [value] : value;\n    }\n}\n\n/**\n * Restores values to their original type\n * @param {string} value undefined or string value\n */\nfunction coerce(value) {\n    if (value == null) return \"\";\n    if (typeof value !== \"string\") return value;\n    value = value.trim();\n    if (isNumber(value)) return +value;\n    switch (value) {\n        case \"null\": return null;\n        case \"undefined\": return undefined;\n        case \"true\": return true;\n        case \"false\": return false;\n        case \"NaN\": return NaN;\n        default: return value;\n    }\n}\n\n// Library encapsulation\nfunction lib() {\n    return deparam.apply(this, arguments);\n}\n\nexport default lib;"],"names":[],"mappings":"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"}