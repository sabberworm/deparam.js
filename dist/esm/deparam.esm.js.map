{"version":3,"file":"deparam.esm.js","sources":["../../src/deparam.js"],"sourcesContent":["// Vars\nconst isBrowser = typeof window !== 'undefined';\n\n// Shorthand for built-ins\nconst isArr = Array.isArray;\n\n/**\n * Checks if input is a number\n * @param {*} key \n */\nfunction isNumber(key) {\n    key = (key + '').trim();\n    if (['null', 'undefined', ''].indexOf(key) > -1) return false;\n    return !Number.isNaN(Number(key));\n}\n\nfunction hasOwn(obj, key) {\n    return Object.prototype.hasOwnProperty.call(obj, key);\n}\n\n/**\n * Checks if key is a true object\n * @param {*} key Any type of value\n */\nfunction isObject(key) {\n    return (key != null && !isArr(key) && key.toString() === '[object Object]');\n}\n\n/**\n * Checks if query parameter key is a complex notation\n * @param {string} q \n */\nfunction ifComplex(q) {\n    return (/\\[/.test(q));\n}\n\n/**\n * Sets default value\n * @param {*} value Any value\n * @param {*} defaultValue Default value if value is undefined\n */\nfunction setDefault(value, defaultValue) {\n    return typeof value === 'undefined' ? defaultValue : value;\n}\n\n/**\n * Converts query string to JavaScript object\n * @param {string} qs query string argument (defaults to url query string)\n */\nfunction deparam(qs, coerce) {\n    qs = setDefault(qs, (isBrowser ? location.search : '')).trim();\n    coerce = setDefault(coerce, true);\n    qs = qs.substring(qs.charAt(0) === '?');\n    const queryParamList = qs.split('&');\n    const queryObject = {};\n    if (qs) {\n        queryParamList.forEach((qq) => {\n            const qArr = qq.split('=').map(part => decodeURIComponent(part));\n            if (ifComplex(qArr[0])) {\n                complex.apply(this, [].concat(qArr).concat([queryObject, coerce]));\n            } else {\n                simple.apply(this, [qArr, queryObject, false, coerce]);\n            }\n        });\n    }\n    return queryObject;\n}\n\n/**\n * Converts an array to an object\n * @param {array} arr \n */\nfunction toObject(arr) {\n    var convertedObj = {};\n    if (isArr(arr)) {\n        arr.forEach((value, index) => {\n            convertedObj[index] = value;\n        });\n    }\n    return convertedObj;\n}\n\n/**\n * Resolves an array to object if required\n * @param {array} ob An array object\n * @param {boolean} isNumber flag to test if next key is number\n */\nfunction resolve(ob, isNextNumber) {\n    if (typeof ob === 'undefined') return isNextNumber ? [] : {};\n    return isNextNumber ? ob : toObject(ob);\n}\n\n/**\n * Resolves the target object for next iteration\n * @param {Object} ob current reference object\n * @param {string} nextProp reference property in current object\n */\nfunction resolveObj(ob, nextProp) {\n    if (isObject(ob)) return { ob };\n    if (isArr(ob) || typeof ob === 'undefined') return { ob: resolve(ob, isNumber(nextProp)) };\n    return { ob: [ob], push: ob !== null };\n}\n\n/**\n * Handles complex query parameters\n * @param {string} key \n * @param {string} value \n * @param {Object} obj \n */\nfunction complex(key, value, obj, doCoerce) {\n    doCoerce = setDefault(doCoerce, true);\n    const match = key.match(/([^\\[]+)\\[([^\\[]*)\\]/) || [];\n    if (match.length === 3) {\n        let prop = match[1];\n        let nextProp = match[2];\n        key = key.replace(/\\[([^\\[]*)\\]/, '');\n        if (ifComplex(key)) {\n            if (nextProp === '') nextProp = '0';\n            key = key.replace(/[^\\[]+/, nextProp);\n            complex(key, value, (obj[prop] = resolveObj(obj[prop], nextProp).ob), doCoerce);\n        } else if (nextProp) {\n            const { ob, push } = resolveObj(obj[prop], nextProp);\n            obj[prop] = ob;\n            const nextOb = push ? {} : obj[prop];\n            nextOb[nextProp] = coerce(value, !doCoerce);\n            if (push) {\n                obj[prop].push(nextOb);\n            }\n        } else {\n            simple([match[1], value], obj, true);\n        }\n    }\n}\n\n/**\n * Handles simple query\n * @param {array} qArr \n * @param {Object} queryObject \n * @param {boolean} toArray \n */\nfunction simple(qArr, queryObject, toArray, doCoerce) {\n    doCoerce = setDefault(doCoerce, true);\n    let key = qArr[0];\n    let value = qArr[1];\n    value = coerce(value, !doCoerce);\n    if (hasOwn(queryObject, key)) {\n        queryObject[key] = isArr(queryObject[key]) ? queryObject[key] : [queryObject[key]];\n        queryObject[key].push(value);\n    } else {\n        queryObject[key] = toArray ? [value] : value;\n    }\n}\n\n/**\n * Restores values to their original type\n * @param {string} value undefined or string value\n */\nfunction coerce(value, skip) {\n    if (value == null) return '';\n    if (skip || typeof value !== 'string') return value;\n    value = value.trim();\n    if (isNumber(value)) return +value;\n    switch (value) {\n        case 'null': return null;\n        case 'undefined': return undefined;\n        case 'true': return true;\n        case 'false': return false;\n        case 'NaN': return NaN;\n        default: return value;\n    }\n}\n\n// Library encapsulation\nfunction lib() {\n    return deparam.apply(this, arguments);\n}\n\nexport default lib;"],"names":["isBrowser","window","isArr","Array","isArray","isNumber","key","trim","indexOf","Number","isNaN","hasOwn","obj","Object","prototype","hasOwnProperty","call","isObject","toString","ifComplex","q","test","setDefault","value","defaultValue","deparam","qs","coerce","location","search","substring","charAt","queryParamList","split","queryObject","forEach","qq","qArr","map","part","decodeURIComponent","complex","apply","concat","simple","toObject","arr","convertedObj","index","resolve","ob","isNextNumber","resolveObj","nextProp","push","doCoerce","match","length","prop","replace","nextOb","toArray","skip","undefined","NaN","lib","arguments"],"mappings":"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"}